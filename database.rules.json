
{
  "rules": {
    "Admins": {
      "$uid": {
        ".write": "(auth != null && root.child('Admins').child(auth.uid).exists()) || (!data.parent().exists() && newData.val() === true)",
        ".read": "auth != null && root.child('Admins').child(auth.uid).exists()"
      }
    },
    "canonicalProducts": {
      ".indexOn": ["normalizedName"],
      ".read": "true",
      ".write": "auth != null && root.child('Admins').child(auth.uid).exists()"
    },
    "advertisements": {
      ".read": "true",
      "$adId": {
        ".write": "auth != null && ( (newData.exists() && root.child('stores').child(newData.child('storeId').val()).child('ownerId').val() === auth.uid) || (!newData.exists() && data.exists() && root.child('stores').child(data.child('storeId').val()).child('ownerId').val() === auth.uid) || root.child('Admins').child(auth.uid).exists() )",
        ".validate": "newData.hasChildren(['storeId', 'name', 'price', 'category', 'createdAt', 'validUntil']) && newData.child('name').isString() && newData.child('price').isNumber() && newData.child('category').isString() && newData.child('createdAt').isNumber() && newData.child('validUntil').isNumber() && newData.child('storeId').isString()"
      }
    },
    "stores": {
      ".read": "true",
      "$storeId": {
        ".write": "auth != null && ( ((!data.exists() && newData.child('ownerId').val() === auth.uid) || (data.exists() && data.child('ownerId').val() === auth.uid)) || root.child('Admins').child(auth.uid).exists() )",
        ".validate": "newData.hasChildren(['ownerId', 'name', 'address', 'city', 'state', 'zipCode', 'email', 'phone', 'category']) && newData.child('ownerId').isString() && newData.child('name').isString() && newData.child('address').isString() && newData.child('city').isString() && newData.child('state').isString() && newData.child('zipCode').isString() && newData.child('email').isString() && newData.child('phone').isString() && newData.child('category').isString()"
      }
    },
    "suggestedNewProducts": {
      ".read": "auth != null && root.child('Admins').child(auth.uid).exists()",
      "$suggestionId": {
        ".write": "auth != null && ((!data.exists() && newData.child('status').val() === 'pending') || (data.exists() && root.child('Admins').child(auth.uid).exists()))",
        ".validate": "newData.hasChildren(['productName', 'source', 'timestamp', 'status']) && newData.child('productName').isString() && newData.child('source').isString() && newData.child('timestamp').isNumber() && newData.child('status').isString()"
      }
    },
    "userSettings": {
      "$uid": {
        ".read": "auth != null && $uid === auth.uid",
        ".write": "auth != null && $uid === auth.uid",
        ".validate": "newData.hasChildren(['preferredLocation']) && newData.child('preferredLocation').hasChildren(['address', 'latitude', 'longitude'])"
      }
    },
    "priceHistory": {
      ".read": "true",
      ".write": "auth != null && root.child('Admins').child(auth.uid).exists()",
      ".validate": "newData.hasChildren(['advertisementId', 'productName', 'price', 'storeId', 'storeName', 'archivedAt', 'originalValidUntil', 'category'])"
    }
  }
}
